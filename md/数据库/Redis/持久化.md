# RDB

RDB持久化方式会间隔特定的时间保存当前的数据快照

## 工作方式

* Redis调用fork()，产生一个子进程

* 父进程继续干活，子进程把内容保存到临时的rdb文件中

* 完成之后，新的rdb文件会把旧的替换掉

## 保存点

可以配置在s秒内超过r个key被修改就产生一个新的快照

```
save 60 100
```

意思是60s内超过了100次的修改，就会产生一个新快照

可以设置多个保存点：

```
save 114 514
save 11 4514
save 1145 14
```

## 优缺点

rdb文件保存了一个时间点的redis数据，很适合用于备份or备灾

性能高，因为是使用一个子进程进行快照生成

然而因为是隔一段时间保存一次快照，如果Redis服务真boom了会丢失最近一段时间的数据

# AOF

aof文件会保存Redis的每一个修改。或者说Redis会把每一次修改信息都追加到aof文件后尾

服务boom掉后，重启时aof文件的命令重新执行一次，就能重建数据了

## 设定

可以设定不同的fsync时机：

* 不fsync（不开启

* 每秒fsync一次（最多-1s

* 每次查询进行fsync

## 日志重写

日久天长之后，AOF文件肯定会过大

AOF支持日志重写功能，通过重建一个aof文件，精简里面的修改记录

## 优缺点

恢复数据更可靠

AOF的操作命令简单易懂，很容易手工修改

相同数据集，AOF的文件比RDB要大


